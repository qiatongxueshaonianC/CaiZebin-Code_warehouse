#include<bits/stdc++.h>
using namespace std; 
const int inf=0x3fffffff;
struct Node{
	int id,data,next;
}L[100005];
int st,n,l;
vector<Node> A;
int main() {
	scanf("%d%d%d",&st,&n,&l);
	int id,da,nex;
	for(int i=0;i<n;i++){
		scanf("%d",&id);
		L[id].id=id;
		scanf("%d%d",&L[id].data,&L[id].next);
	}
	int temp=st;
	while(temp!=-1){
		A.push_back(L[temp]);
		temp=L[temp].next;
	}
	auto it1=A.begin(),it2=A.begin();
	for(int i=0;i<l;i++) it2++;
//	pair<vector<Node>::iterator,vector<Node>::iterator> P(it1,it2);
	for(int i=0;i+l<=A.size();i+=l){
		reverse(it1,it2);
		for(int j=0;j<l;j++){
			it1++;
			it2++;
		}	
	}
	if(l>A.size()) 
		reverse(A.begin(),A.end());
	for(int i=0;i<A.size()-1;i++)
		A[i].next=A[i+1].id;
	for(int i=0;i<A.size();i++){
		if(i!=A.size()-1) printf("%05d %d %05d\n",A[i].id,A[i].data,A[i].next);
		else printf("%05d %d %d\n",A[i].id,A[i].data,-1);
	}
	return 0;
}
/*
00100 6 3
00000 4 99999
00100 1 12309
68237 6 -1
33218 3 00000
99999 5 68237
12309 2 33218

00100 1 12309
12309 2 33218
33218 3 00000
00000 4 99999
99999 5 68237
68237 6 -1

00100 6 4
00000 4 99999
00100 1 12309
68237 6 -1
33218 3 00000
99999 5 68237
12309 2 33218

00100 6 10
00000 4 99999
00100 1 12309
68237 6 -1
33218 3 00000
99999 5 68237
12309 2 33218

00100 6 6
00000 4 99999
00100 1 12309
68237 6 -1
33218 3 00000
99999 5 68237
12309 2 33218
*/ 